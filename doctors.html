<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find Doctors - MediGuide AI</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<h1>Find Nearby Doctors</h1>
<input id="specialization" placeholder="Cardiologist, Dentistâ€¦" />
<button onclick="init()">Find Doctors</button>

<div id="map" style="height:500px;"></div>

<script>
let map;

async function loadMapScript() {
  const res = await fetch("http://localhost:3001/api/maps-key");
  const data = await res.json();

  const script = document.createElement("script");
  script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places`;
  script.defer = true;
  script.async = true;
  script.onload = () => initMap();
  document.head.appendChild(script);
}

function initMap() {
  navigator.geolocation.getCurrentPosition(pos => {
    const center = {
      lat: pos.coords.latitude,
      lng: pos.coords.longitude
    };

    map = new google.maps.Map(document.getElementById("map"), {
      center,
      zoom: 14
    });

    findDoctors(center);
  });
}

async function findDoctors(center) {
  const type = document.getElementById("specialization").value || "doctor";

  const res = await fetch(
    `http://localhost:3001/api/nearby-doctors?lat=${center.lat}&lng=${center.lng}&type=${type}`
  );

  const data = await res.json();

  data.results.forEach(place => {
    new google.maps.Marker({
      map,
      position: place.geometry.location,
      title: place.name
    });
  });
}

function init() {
  if (!window.google) loadMapScript();
}
</script>

</body>
</html>
